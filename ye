#!/usr/bin/env bash
# barebash - minimal script launcher with auto-create feature
# Author: Herv√© Balderacchi

# Use env var if set, fallback to local scripts dir
SCRIPTS_DIR="${SCRIPTS_DIR:-$(dirname "$(realpath "${BASH_SOURCE[0]}")")/../scripts}"

ye_run() {
    local script="$1"
    shift

    if [[ -z "$script" ]]; then
        echo "Usage: ye <script> [edit|args]"
        return 1
    fi

    local path="$SCRIPTS_DIR/$script.sh"

    # üß† If the script doesn't exist, offer to create it
    if [[ ! -f "$path" ]]; then
        echo "‚ö†Ô∏è  Script not found: $path"
        read -p "Would you like to create it? [y/N] " choice
        if [[ "$choice" =~ ^[Yy]$ ]]; then
            mkdir -p "$SCRIPTS_DIR"
            echo "#!/usr/bin/env bash" > "$path"
            echo "" >> "$path"
            chmod +x "$path"
            echo "‚úÖ Created new script: $path"
            ${EDITOR:-vim} "$path"
        else
            echo "‚ùå Aborted."
        fi
        return 0
    fi

    # üß© If 'edit' argument is used
    if [[ "$1" == "edit" ]]; then
        ${EDITOR:-vim} "$path"
        return 0
    fi

    # üß± Otherwise execute the script
    bash "$path" "$@"
}

ye_run "$@"