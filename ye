#!/usr/bin/env bash
# barebash - minimal script launcher inspired by Yeoman
# Author: Hervé Balderacchi

SCRIPTS_DIR="${SCRIPTS_DIR:-$(dirname "$(realpath "${BASH_SOURCE[0]}")")/../scripts]}"

# --- Command logic ---
ye_run() {
    local script="$1"
    shift
    if [[ -z "$script" ]]; then
        echo "Usage: ye <script> [edit|args]"
        return 1
    fi

    local path="$SCRIPTS_DIR/$script.sh"
    if [[ ! -f "$path" ]]; then
        echo "❌ Script not found: $path"
        return 1
    fi

    if [[ "$1" == "edit" ]]; then
        ${EDITOR:-vim} "$path"
    else
        bash "$path" "$@"
    fi
}

# completion/ye.bash
_ye_complete() {
    local cur prev
    cur="${COMP_WORDS[COMP_CWORD]}"
    prev="${COMP_WORDS[COMP_CWORD-1]}"

    local scripts_dir="${SCRIPTS_DIR:-$HOME/barebash/scripts}"
    local opts=()

    # List all available .sh scripts
    for f in "$scripts_dir"/*.sh; do
        [[ -e "$f" ]] && opts+=("$(basename "${f%.sh}")")
    done

    # Completion rules
    if [[ $COMP_CWORD -eq 1 ]]; then
        COMPREPLY=( $(compgen -W "${opts[*]}" -- "$cur") )
    elif [[ $COMP_CWORD -eq 2 && " ${opts[*]} " =~ " ${prev} " ]]; then
        COMPREPLY=( $(compgen -W "edit" -- "$cur") )
    fi
}
complete -F _ye_complete ye

ye_run "$@"